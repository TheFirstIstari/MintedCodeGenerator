\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Windows}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Windows.Controls}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{UserInterface.HelperClasses}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{UserInterface.ViewModels}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{UserInterface.Views}\PYG{p}{;}

\PYG{c+cp}{\PYGZsh{}pragma warning disable CS8618 // Compiler doesn\PYGZsq{}t understand that Start() is functionally the constructor for this class.}

\PYG{k}{namespace}\PYG{+w}{ }\PYG{n+nn}{UserInterface}
\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{c+c1}{/// \PYGZlt{}summary\PYGZgt{}}
\PYG{+w}{    }\PYG{c+c1}{/// Interaction logic for App.xaml}
\PYG{+w}{    }\PYG{c+c1}{/// \PYGZlt{}/summary\PYGZgt{}}
\PYG{+w}{    }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{partial}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{App}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{Application}
\PYG{+w}{    }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{UserControl}\PYG{+w}{ }\PYG{n}{currentUserControl}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{UserControl}\PYG{o}{?}\PYG{+w}{ }\PYG{n}{currentPopup}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{MainWindow}\PYG{+w}{ }\PYG{n}{fullScreenWindowContainer}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// 2 different container windows to allow for usercontrols to either be popups (that don\PYGZsq{}t take up the whole screen), or fullscreen}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{PopupWindow}\PYG{+w}{ }\PYG{n}{popupWindowContainer}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{ParameterHolder}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{static}\PYG{+w}{ }\PYG{k}{event}\PYG{+w}{ }\PYG{n}{EventHandler}\PYG{o}{\PYGZlt{}}\PYG{n}{UserControlChangeEventArgs}\PYG{o}{\PYGZgt{}?}\PYG{+w}{ }\PYG{n}{UserControlChanged}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{static}\PYG{+w}{ }\PYG{k}{event}\PYG{+w}{ }\PYG{n}{EventHandler}\PYG{o}{\PYGZlt{}}\PYG{n}{UserControlChangeEventArgs}\PYG{o}{\PYGZgt{}?}\PYG{+w}{ }\PYG{n}{PopupCreated}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{static}\PYG{+w}{ }\PYG{k}{event}\PYG{+w}{ }\PYG{n}{EventHandler}\PYG{o}{\PYGZlt{}}\PYG{n}{EventArgs}\PYG{o}{\PYGZgt{}?}\PYG{+w}{ }\PYG{n}{PopupDeleted}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{ChangeUserControl}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{UserControlChangeEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{currentUserControl}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{UserControl}\PYG{p}{)}\PYG{n}{Activator}\PYG{p}{.}\PYG{n}{CreateInstance}\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{NewUserControlType}\PYG{p}{,}\PYG{+w}{ }\PYG{p}{[}\PYG{n}{parameterHolder}\PYG{p}{]);}\PYG{+w}{ }\PYG{c+c1}{// Use the Type parameter to create a new instance}

\PYG{+w}{            }\PYG{n}{fullScreenWindowContainer}\PYG{p}{.}\PYG{n}{Content}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{currentUserControl}\PYG{p}{;}

\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{CreatePopup}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{UserControlChangeEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{currentPopup}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{UserControl}\PYG{p}{)}\PYG{n}{Activator}\PYG{p}{.}\PYG{n}{CreateInstance}\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{NewUserControlType}\PYG{p}{,}\PYG{+w}{ }\PYG{p}{[}\PYG{n}{parameterHolder}\PYG{p}{]);}
\PYG{+w}{            }\PYG{n}{popupWindowContainer}\PYG{p}{.}\PYG{n}{Content}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{currentPopup}\PYG{p}{;}

\PYG{+w}{            }\PYG{n}{popupWindowContainer}\PYG{p}{.}\PYG{n}{Show}\PYG{p}{();}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{DeletePopup}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{EventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{currentPopup}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{popupWindowContainer}\PYG{p}{.}\PYG{n}{Content}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{currentPopup}\PYG{p}{;}

\PYG{+w}{            }\PYG{n}{popupWindowContainer}\PYG{p}{.}\PYG{n}{Hide}\PYG{p}{();}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{c+c1}{// Static method for other classes to invoke events without the App instance.}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{static}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{RaiseUserControlChanged}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{UserControlChangeEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}\PYG{+w}{ }
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{UserControlChanged}\PYG{p}{.}\PYG{n}{Invoke}\PYG{p}{(}\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{);}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{static}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{RaisePopupCreated}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{UserControlChangeEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{PopupCreated}\PYG{p}{.}\PYG{n}{Invoke}\PYG{p}{(}\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{);}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{static}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{RaisePopupDeleted}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{EventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{PopupDeleted}\PYG{p}{.}\PYG{n}{Invoke}\PYG{p}{(}\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{);}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Start}\PYG{p}{(}\PYG{k+kt}{object}\PYG{+w}{ }\PYG{n}{Sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{StartupEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{fullScreenWindowContainer}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{MainWindow}\PYG{p}{();}\PYG{+w}{ }\PYG{c+c1}{// Initialise container windows}
\PYG{+w}{            }\PYG{n}{popupWindowContainer}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PopupWindow}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{Height}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{400}\PYG{p}{,}
\PYG{+w}{                }\PYG{n}{Width}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{700}
\PYG{+w}{            }\PYG{p}{\PYGZcb{};}

\PYG{+w}{            }\PYG{n}{parameterHolder}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{p}{(}\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{WIDTH}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{HEIGHT}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{TIMESTEP\PYGZus{}SAFETY\PYGZus{}FACTOR}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{RELAXATION\PYGZus{}PARAMETER}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{PRESSURE\PYGZus{}RESIDUAL\PYGZus{}TOLERANCE}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{PRESSURE\PYGZus{}MAX\PYGZus{}ITERATIONS}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{REYNOLDS\PYGZus{}NUMBER}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{FLUID\PYGZus{}VISCOSITY}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{FLUID\PYGZus{}VELOCITY}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{SURFACE\PYGZus{}FRICTION}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{FieldParameters}\PYG{p}{(),}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{DRAW\PYGZus{}CONTOURS}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{CONTOUR\PYGZus{}TOLERANCE}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{CONTOUR\PYGZus{}SPACING}\PYG{p}{);}\PYG{+w}{ }\PYG{c+c1}{// Use the defaults from DefaultParameters constant holder}

\PYG{+w}{            }\PYG{n}{currentUserControl}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{ConfigScreen}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{fullScreenWindowContainer}\PYG{p}{.}\PYG{n}{Content}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{currentUserControl}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{fullScreenWindowContainer}\PYG{p}{.}\PYG{n}{Show}\PYG{p}{();}

\PYG{+w}{            }\PYG{n}{UserControlChanged}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{n}{ChangeUserControl}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{PopupCreated}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{n}{CreatePopup}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{PopupDeleted}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{n}{DeletePopup}\PYG{p}{;}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Application\PYGZus{}Exit}\PYG{p}{(}\PYG{k+kt}{object}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ExitEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{currentUserControl}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{SimulationScreen}\PYG{+w}{ }\PYG{n}{simulationScreen}\PYG{p}{)}\PYG{+w}{ }\PYG{c+c1}{// Close the backend if it is running when application exits (current screen will be SimulationScreen).}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{simulationScreen}\PYG{p}{.}\PYG{n}{ViewModel}\PYG{p}{.}\PYG{n}{CloseBackend}\PYG{p}{();}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{c+c1}{//public void StartVisualisationDebugging(object sender, StartupEventArgs e)}
\PYG{+w}{        }\PYG{c+c1}{//\PYGZob{}}
\PYG{+w}{        }\PYG{c+c1}{//    fullScreenWindowContainer = new MainWindow();}
\PYG{+w}{        }\PYG{c+c1}{//    fullScreenWindowContainer.Content = new VisualisationControl();}
\PYG{+w}{        }\PYG{c+c1}{//    fullScreenWindowContainer.Show();}
\PYG{+w}{        }\PYG{c+c1}{//\PYGZcb{}}
\PYG{+w}{    }\PYG{p}{\PYGZcb{}}

\PYG{+w}{    }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{UserControlChangeEventArgs}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{EventArgs}\PYG{+w}{ }\PYG{c+c1}{// EventArgs derivative containing the typename of the new user control}
\PYG{+w}{    }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{Type}\PYG{+w}{ }\PYG{n}{NewUserControlType}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{UserControlChangeEventArgs}\PYG{p}{(}\PYG{n}{Type}\PYG{+w}{ }\PYG{n}{newUserControlType}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{NewUserControlType}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{newUserControlType}\PYG{p}{;}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{    }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{Verbatim}
