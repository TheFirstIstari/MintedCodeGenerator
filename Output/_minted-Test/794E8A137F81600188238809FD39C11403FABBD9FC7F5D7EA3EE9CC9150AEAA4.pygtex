\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Collections.Generic}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Collections.ObjectModel}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Collections.Specialized}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.ComponentModel}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Diagnostics}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.IO}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Threading}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Threading.Tasks}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Windows}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{UserInterface.Converters}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{UserInterface.HelperClasses}\PYG{p}{;}

\PYG{k}{namespace}\PYG{+w}{ }\PYG{n+nn}{UserInterface.ViewModels}
\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{SimulationScreenVM}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{ViewModel}
\PYG{+w}{    }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{c+cp}{\PYGZsh{}region Fields, Properties and Enums}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{SidePanelButton}\PYG{o}{?}\PYG{+w}{ }\PYG{n}{currentButton}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{visLowerBound}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{visUpperBound}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{p}{[]}\PYG{+w}{ }\PYG{n}{velocity}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{p}{[]}\PYG{+w}{ }\PYG{n}{pressure}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{p}{[]}\PYG{+w}{ }\PYG{n}{streamFunction}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{n}{pressureParameters}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{n}{velocityParameters}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{+w}{ }\PYG{n}{selectedField}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{BackendManager}\PYG{+w}{ }\PYG{n}{backendManager}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{CancellationTokenSource}\PYG{+w}{ }\PYG{n}{backendCTS}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{VisualisationControl}\PYG{+w}{ }\PYG{n}{visualisationControl}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{MovingAverage}\PYG{o}{\PYGZlt{}}\PYG{k+kt}{float}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{visFrameTimeAverage}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{MovingAverage}\PYG{o}{\PYGZlt{}}\PYG{k+kt}{float}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{backFrameTimeAverage}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{RectangularToPolar}\PYG{+w}{ }\PYG{n}{RecToPolConverter}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{dataWidth}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{dataHeight}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{ObservableCollection}\PYG{o}{\PYGZlt{}}\PYG{n}{PolarPoint}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{obstaclePoints}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{ObservableCollection}\PYG{o}{\PYGZlt{}}\PYG{n}{PolarPoint}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{controlPoints}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{PolarSplineCalculator}\PYG{+w}{ }\PYG{n}{obstaclePointCalculator}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n}{editingObstacles}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{Point}\PYG{+w}{ }\PYG{n}{obstacleCentre}\PYG{p}{;}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{const}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{numObstaclePoints}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{80}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{const}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{boundaryTop}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{0.55f}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{const}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{boundaryLeft}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{0.15f}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{const}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{boundaryHeight}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{0.1f}\PYG{p}{;}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{const}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{boundaryWidth}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{0.1f}\PYG{p}{;}


\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{string?}\PYG{+w}{ }\PYG{n}{CurrentButton}\PYG{+w}{ }\PYG{c+c1}{//Conversion between string and internal enum value done in property}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{currentButton}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{)}\PYG{+w}{ }\PYG{k}{return}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{;}
\PYG{+w}{                }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{Enum}\PYG{p}{.}\PYG{n}{GetName}\PYG{p}{(}\PYG{k}{typeof}\PYG{p}{(}\PYG{n}{SidePanelButton}\PYG{p}{),}\PYG{+w}{ }\PYG{n}{currentButton}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{k}{value}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{)}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{currentButton}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{;}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                }\PYG{k}{else}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{currentButton}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{SidePanelButton}\PYG{p}{)}\PYG{n}{Enum}\PYG{p}{.}\PYG{n}{Parse}\PYG{p}{(}\PYG{k}{typeof}\PYG{p}{(}\PYG{n}{SidePanelButton}\PYG{p}{),}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{);}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{currentButton}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{InVel}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{InflowVelocity}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{InflowVelocity}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{InflowVelocity}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{InVel}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{Chi}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{SurfaceFriction}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{SurfaceFriction}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{SurfaceFriction}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{Chi}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{VisMin}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{.}\PYG{n}{min}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ModifyFieldParameters}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{));}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{VisMin}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{VisMax}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{.}\PYG{n}{max}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ModifyFieldParameters}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{));}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{VisMax}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{VisLowerBound}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{visLowerBound}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{visLowerBound}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{VisLowerBound}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{VisUpperBound}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{visUpperBound}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{visUpperBound}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{VisUpperBound}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{ContourSpacing}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{ContourSpacing}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{ContourSpacing}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{ContourSpacing}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{ContourSpacing}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{ContourTolerance}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{ContourTolerance}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{ContourTolerance}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{ContourTolerance}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{ContourTolerance}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n}{PressureChecked}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Pressure}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{k}{value}\PYG{p}{)}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Pressure}\PYG{p}{;}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                }\PYG{k}{else}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Velocity}\PYG{p}{;}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}

\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{PressureChecked}\PYG{p}{));}
\PYG{+w}{                }\PYG{n}{SwitchFieldParameters}\PYG{p}{();}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n}{VelocityChecked}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Velocity}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{k}{value}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Velocity}\PYG{p}{;}
\PYG{+w}{                }\PYG{k}{else}\PYG{+w}{ }\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Pressure}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{VelocityChecked}\PYG{p}{));}
\PYG{+w}{                }\PYG{n}{SwitchFieldParameters}\PYG{p}{();}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n}{StreamlinesEnabled}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{DrawContours}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{DrawContours}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{DrawContours}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{StreamlinesEnabled}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n}{EditingObstacles}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{editingObstacles}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{editingObstacles}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{EditingObstacles}\PYG{p}{));}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{EditObstaclesButtonText}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{ObservableCollection}\PYG{o}{\PYGZlt{}}\PYG{n}{PolarPoint}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{ObstaclePoints}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{obstaclePoints}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{ObservableCollection}\PYG{o}{\PYGZlt{}}\PYG{n}{PolarPoint}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{ControlPoints}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{controlPoints}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{Point}\PYG{+w}{ }\PYG{n}{ObstacleCentre}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{obstacleCentre}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{set}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{obstacleCentre}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{ObstacleCentre}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{VisualisationControl}\PYG{+w}{ }\PYG{n}{VisualisationControl}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{visualisationControl}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{VisFPS}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{l+m}{1}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{n}{visFrameTimeAverage}\PYG{p}{.}\PYG{n}{Average}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{+w}{ }\PYG{n}{BackFPS}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{l+m}{1}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{n}{backFrameTimeAverage}\PYG{p}{.}\PYG{n}{Average}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{CancellationTokenSource}\PYG{+w}{ }\PYG{n}{BackendCTS}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{backendCTS}\PYG{p}{;}\PYG{+w}{ }\PYG{k}{set}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{backendCTS}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{value}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{string}\PYG{+w}{ }\PYG{n}{BackendButtonText}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{BackendStatus}\PYG{+w}{ }\PYG{k}{switch}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{BackendStatus}\PYG{p}{.}\PYG{n}{Running}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}Pause simulation\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{                    }\PYG{n}{BackendStatus}\PYG{p}{.}\PYG{n}{Stopped}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}Resume simulation\PYGZdq{}}\PYG{p}{,}
\PYG{+w}{                    }\PYG{n}{\PYGZus{}}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{k+kt}{string}\PYG{p}{.}\PYG{n}{Empty}\PYG{p}{,}
\PYG{+w}{                }\PYG{p}{\PYGZcb{};}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{string}\PYG{+w}{ }\PYG{n}{EditObstaclesButtonText}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{EditingObstacles}\PYG{+w}{ }\PYG{o}{?}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}Finish editing\PYGZdq{}}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{l+s}{\PYGZdq{}Edit simulation obstacles\PYGZdq{}}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{BackendStatus}\PYG{+w}{ }\PYG{n}{BackendStatus}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{get}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{BackendStatus}\PYG{p}{;}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{SwitchPanel}\PYG{+w}{ }\PYG{n}{SwitchPanelCommand}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{p}{;}\PYG{+w}{ }\PYG{k}{set}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{PauseResumeBackend}\PYG{+w}{ }\PYG{n}{BackendCommand}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{p}{;}\PYG{+w}{ }\PYG{k}{set}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{ChangeWindow}\PYG{+w}{ }\PYG{n}{ChangeWindowCommand}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{p}{;}\PYG{+w}{ }\PYG{k}{set}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{CreatePopup}\PYG{+w}{ }\PYG{n}{CreatePopupCommand}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{p}{;}\PYG{+w}{ }\PYG{k}{set}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{EditObstacles}\PYG{+w}{ }\PYG{n}{EditObstaclesCommand}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{get}\PYG{p}{;}\PYG{+w}{ }\PYG{k}{set}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{enum}\PYG{+w}{ }\PYG{n}{SidePanelButton}\PYG{+w}{ }\PYG{c+c1}{//Different side panels on SimluationScreen}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{BtnParametersSelect}\PYG{p}{,}
\PYG{+w}{            }\PYG{n}{BtnUnitsSelect}\PYG{p}{,}
\PYG{+w}{            }\PYG{n}{BtnVisualisationSettingsSelect}\PYG{p}{,}
\PYG{+w}{            }\PYG{n}{BtnRecordingSelect}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{enum}\PYG{+w}{ }\PYG{n}{SelectedField}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{Pressure}\PYG{p}{,}
\PYG{+w}{            }\PYG{n}{Velocity}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{event}\PYG{+w}{ }\PYG{n}{CancelEventHandler}\PYG{+w}{ }\PYG{n}{StopBackendExecuting}\PYG{p}{;}
\PYG{+w}{        }\PYG{c+cp}{\PYGZsh{}endregion}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{SimulationScreenVM}\PYG{p}{(}\PYG{n}{ParameterHolder}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{c+cp}{\PYGZsh{}region Parameters related to View}
\PYG{+w}{            }\PYG{n}{currentButton}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// Initially no panel selected}
\PYG{+w}{            }\PYG{n}{obstaclePoints}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{ObservableCollection}\PYG{o}{\PYGZlt{}}\PYG{n}{PolarPoint}\PYG{o}{\PYGZgt{}}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{controlPoints}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{ObservableCollection}\PYG{o}{\PYGZlt{}}\PYG{n}{PolarPoint}\PYG{o}{\PYGZgt{}}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{obstacleCentre}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{Point}\PYG{p}{(}\PYG{l+m}{50}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m}{50}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{obstaclePointCalculator}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PolarSplineCalculator}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{CreateDefaultObstacle}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{controlPoints}\PYG{p}{.}\PYG{n}{CollectionChanged}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{n}{OnControlPointsChanged}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{editingObstacles}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{false}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{InVel}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{InflowVelocity}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{Chi}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{SurfaceFriction}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{;}


\PYG{+w}{            }\PYG{n}{SwitchPanelCommand}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{SwitchPanel}\PYG{p}{(}\PYG{k}{this}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{BackendCommand}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{PauseResumeBackend}\PYG{p}{(}\PYG{k}{this}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{EditObstaclesCommand}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{EditObstacles}\PYG{p}{(}\PYG{k}{this}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{ChangeWindowCommand}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{ChangeWindow}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{CreatePopupCommand}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{Commands}\PYG{p}{.}\PYG{n}{CreatePopup}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{RecToPolConverter}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{RectangularToPolar}\PYG{p}{();}
\PYG{+w}{            }\PYG{c+cp}{\PYGZsh{}endregion}

\PYG{+w}{            }\PYG{c+cp}{\PYGZsh{}region Parameters related to Backend}
\PYG{+w}{            }\PYG{n}{backendCTS}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{CancellationTokenSource}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{StopBackendExecuting}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{CancelEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=\PYGZgt{}}\PYG{+w}{ }\PYG{n}{backendCTS}\PYG{p}{.}\PYG{n}{Cancel}\PYG{p}{();}

\PYG{+w}{            }\PYG{n}{backendManager}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{BackendManager}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{);}
\PYG{+w}{            }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n}{connectionSuccess}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{ConnectBackend}\PYG{p}{();}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{o}{!}\PYG{n}{connectionSuccess}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{MessageBox}\PYG{p}{.}\PYG{n}{Show}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}Fatal error: backend did not connect properly.\PYGZdq{}}\PYG{p}{);}
\PYG{+w}{                }\PYG{k}{throw}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n+nf}{IOException}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}Backend did not connect properly.\PYGZdq{}}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{SendAllParameters}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{velocity}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{p}{[}\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{FieldLength}\PYG{p}{];}
\PYG{+w}{            }\PYG{n}{pressure}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{p}{[}\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{FieldLength}\PYG{p}{];}
\PYG{+w}{            }\PYG{n}{streamFunction}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{p}{[}\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{FieldLength}\PYG{p}{];}
\PYG{+w}{            }\PYG{n}{dataWidth}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{IMax}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{dataHeight}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{JMax}\PYG{p}{;}
\PYG{+w}{            }\PYG{c+c1}{//SendObstacles();}
\PYG{+w}{            }\PYG{n}{EmbedObstacles}\PYG{p}{();}

\PYG{+w}{            }\PYG{n}{Task}\PYG{p}{.}\PYG{n}{Run}\PYG{p}{(}\PYG{n}{StartComputation}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{backFrameTimeAverage}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{MovingAverage}\PYG{o}{\PYGZlt{}}\PYG{k+kt}{float}\PYG{o}{\PYGZgt{}}\PYG{p}{(}\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{FPS\PYGZus{}WINDOW\PYGZus{}SIZE}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{PropertyChanged}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{n}{HandleBackendPropertyChanged}\PYG{p}{;}
\PYG{+w}{            }\PYG{c+cp}{\PYGZsh{}endregion}

\PYG{+w}{            }\PYG{c+cp}{\PYGZsh{}region Parameters related to Visualisation}
\PYG{+w}{            }\PYG{n}{SetFieldDefaults}\PYG{p}{();}
\PYG{+w}{            }\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Velocity}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// Velocity selected initially.}
\PYG{+w}{            }\PYG{n}{SwitchFieldParameters}\PYG{p}{();}

\PYG{+w}{            }\PYG{n}{visualisationControl}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{VisualisationControl}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{streamFunction}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{dataWidth}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{dataHeight}\PYG{p}{);}\PYG{+w}{ }\PYG{c+c1}{// Content of VisualisationControlHolder is bound to this.}
\PYG{+w}{            }\PYG{n}{visualisationControl}\PYG{p}{.}\PYG{n}{PropertyChanged}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{n}{VisFPSUpdate}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// FPS updating method}
\PYG{+w}{            }\PYG{n}{visFrameTimeAverage}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{MovingAverage}\PYG{o}{\PYGZlt{}}\PYG{k+kt}{float}\PYG{o}{\PYGZgt{}}\PYG{p}{(}\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{FPS\PYGZus{}WINDOW\PYGZus{}SIZE}\PYG{p}{);}
\PYG{+w}{            }\PYG{c+cp}{\PYGZsh{}endregion}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{OnControlPointsChanged}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{NotifyCollectionChangedEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{switch}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{Action}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{case}\PYG{+w}{ }\PYG{n}{NotifyCollectionChangedAction}\PYG{p}{.}\PYG{n}{Add}\PYG{p}{:}
\PYG{+w}{                    }\PYG{k}{foreach}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{point}\PYG{+w}{ }\PYG{k}{in}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{.}\PYG{n}{NewItems}\PYG{p}{)}
\PYG{+w}{                    }\PYG{p}{\PYGZob{}}
\PYG{+w}{                        }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{point}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{not}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{+w}{ }\PYG{n}{polarPoint}\PYG{p}{)}
\PYG{+w}{                        }\PYG{p}{\PYGZob{}}
\PYG{+w}{                            }\PYG{k}{throw}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n+nf}{ArgumentException}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}The item added to the collection was not valid.\PYGZdq{}}\PYG{p}{);}
\PYG{+w}{                        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                        }\PYG{n}{obstaclePointCalculator}\PYG{p}{.}\PYG{n}{AddControlPoint}\PYG{p}{(}\PYG{n}{polarPoint}\PYG{p}{);}
\PYG{+w}{                    }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                    }\PYG{k}{break}\PYG{p}{;}
\PYG{+w}{                    }
\PYG{+w}{                }\PYG{k}{case}\PYG{+w}{ }\PYG{n}{NotifyCollectionChangedAction}\PYG{p}{.}\PYG{n}{Remove}\PYG{p}{:}
\PYG{+w}{                    }\PYG{k}{foreach}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{point}\PYG{+w}{ }\PYG{k}{in}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{.}\PYG{n}{OldItems}\PYG{p}{)}
\PYG{+w}{                    }\PYG{p}{\PYGZob{}}
\PYG{+w}{                        }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{point}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{not}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{+w}{ }\PYG{n}{polarPoint}\PYG{p}{)}
\PYG{+w}{                        }\PYG{p}{\PYGZob{}}
\PYG{+w}{                            }\PYG{k}{throw}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n+nf}{ArgumentException}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}The item removed from the collection was not valid\PYGZdq{}}\PYG{p}{);}
\PYG{+w}{                        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                        }\PYG{n}{obstaclePointCalculator}\PYG{p}{.}\PYG{n}{RemoveControlPoint}\PYG{p}{(}\PYG{n}{polarPoint}\PYG{p}{);}
\PYG{+w}{                    }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                    }\PYG{k}{break}\PYG{p}{;}

\PYG{+w}{                }\PYG{k}{case}\PYG{+w}{ }\PYG{n}{NotifyCollectionChangedAction}\PYG{p}{.}\PYG{n}{Replace}\PYG{p}{:}
\PYG{+w}{                    }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{OldItems}\PYG{p}{[}\PYG{l+m}{0}\PYG{p}{]}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{not}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{+w}{ }\PYG{n}{oldPoint}\PYG{+w}{ }\PYG{o}{||}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{.}\PYG{n}{NewItems}\PYG{p}{[}\PYG{l+m}{0}\PYG{p}{]}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{not}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{+w}{ }\PYG{n}{newPoint}\PYG{p}{)}
\PYG{+w}{                    }\PYG{p}{\PYGZob{}}
\PYG{+w}{                        }\PYG{k}{throw}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n+nf}{ArgumentException}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}The item removed from the collection was not valid\PYGZdq{}}\PYG{p}{);}
\PYG{+w}{                    }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                    }\PYG{n}{obstaclePointCalculator}\PYG{p}{.}\PYG{n}{ModifyControlPoint}\PYG{p}{(}\PYG{n}{oldPoint}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{newPoint}\PYG{p}{);}\PYG{+w}{ }\PYG{c+c1}{// Check if NewItems contains the new item here.}
\PYG{+w}{                    }\PYG{k}{break}\PYG{p}{;}
\PYG{+w}{                }\PYG{k}{default}\PYG{p}{:}
\PYG{+w}{                    }\PYG{k}{throw}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n+nf}{InvalidOperationException}\PYG{p}{(}\PYG{l+s}{\PYGZdq{}Only add, modify and remove are supported for obstacle points collection.\PYGZdq{}}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{c+c1}{// If control has reached this point, a valid modification has been made to the control points collection}
\PYG{+w}{            }\PYG{n}{PlotObstaclePoints}\PYG{p}{();}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{SetFieldDefaults}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{velocityParameters}\PYG{p}{.}\PYG{n}{field}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{velocity}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{velocityParameters}\PYG{p}{.}\PYG{n}{min}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{VELOCITY\PYGZus{}MIN}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{velocityParameters}\PYG{p}{.}\PYG{n}{max}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{VELOCITY\PYGZus{}MAX}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{pressureParameters}\PYG{p}{.}\PYG{n}{field}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{pressure}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{pressureParameters}\PYG{p}{.}\PYG{n}{min}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{PRESSURE\PYGZus{}MIN}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{pressureParameters}\PYG{p}{.}\PYG{n}{max}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{PRESSURE\PYGZus{}MAX}\PYG{p}{;}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{SwitchFieldParameters}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{selectedField}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{n}{SelectedField}\PYG{p}{.}\PYG{n}{Pressure}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{pressureParameters}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{VisLowerBound}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{PRESSURE\PYGZus{}MIN}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{VisUpperBound}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{PRESSURE\PYGZus{}MAX}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{else}\PYG{+w}{ }\PYG{c+c1}{// Velocity selected}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{velocityParameters}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{VisLowerBound}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{VELOCITY\PYGZus{}MIN}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{VisUpperBound}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{VELOCITY\PYGZus{}MAX}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{n}{VisMin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{.}\PYG{n}{min}\PYG{p}{;}
\PYG{+w}{            }\PYG{n}{VisMax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{FieldParameters}\PYG{p}{.}\PYG{n}{Value}\PYG{p}{.}\PYG{n}{max}\PYG{p}{;}


\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{n+nf}{ModifyFieldParameters}\PYG{p}{(}\PYG{n}{FieldParameters}\PYG{+w}{ }\PYG{n}{fieldParameters}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{float}\PYG{p}{[]}\PYG{o}{?}\PYG{+w}{ }\PYG{n}{newField}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{float?}\PYG{+w}{ }\PYG{n}{newMin}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{float?}\PYG{+w}{ }\PYG{n}{newMax}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{newField}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{not}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{fieldParameters}\PYG{p}{.}\PYG{n}{field}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{newField}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{newMin}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{not}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{fieldParameters}\PYG{p}{.}\PYG{n}{min}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{float}\PYG{p}{)}\PYG{n}{newMin}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{newMax}\PYG{+w}{ }\PYG{k}{is}\PYG{+w}{ }\PYG{n}{not}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{fieldParameters}\PYG{p}{.}\PYG{n}{max}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{float}\PYG{p}{)}\PYG{n}{newMax}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{fieldParameters}\PYG{p}{;}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n+nf}{SendObstacles}\PYG{p}{()}\PYG{+w}{ }\PYG{c+c1}{// Temporary method to create a square of obstacle cells}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k+kt}{bool}\PYG{p}{[]}\PYG{+w}{ }\PYG{n}{obstacles}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{p}{[(}\PYG{n}{dataWidth}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{dataHeight}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)];}

\PYG{+w}{            }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{1}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{\PYGZlt{}=}\PYG{+w}{ }\PYG{n}{dataWidth}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{1}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{\PYGZlt{}=}\PYG{+w}{ }\PYG{n}{dataHeight}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{obstacles}\PYG{p}{[}\PYG{n}{i}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{dataHeight}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{j}\PYG{p}{]}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{true}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// Set cells to fluid}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{leftCell}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{p}{)(}\PYG{n}{boundaryLeft}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{dataWidth}\PYG{p}{);}
\PYG{+w}{            }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{rightCell}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{p}{)((}\PYG{n}{boundaryLeft}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{boundaryWidth}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{dataWidth}\PYG{p}{);}
\PYG{+w}{            }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{bottomCell}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{p}{)((}\PYG{n}{boundaryTop}\PYG{+w}{ }\PYG{o}{\PYGZhy{}}\PYG{+w}{ }\PYG{n}{boundaryHeight}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{dataHeight}\PYG{p}{);}
\PYG{+w}{            }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{topCell}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{p}{)(}\PYG{n}{boundaryTop}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{dataHeight}\PYG{p}{);}

\PYG{+w}{            }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{leftCell}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{rightCell}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{c+c1}{// Create a square of boundary cells}
\PYG{+w}{                }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{bottomCell}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{topCell}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{obstacles}\PYG{p}{[(}\PYG{n}{i}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{1}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{dataHeight}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{1}\PYG{p}{]}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{false}\PYG{p}{;}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}


\PYG{+w}{            }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{SendObstacles}\PYG{p}{(}\PYG{n}{obstacles}\PYG{p}{);}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{StartComputation}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{try}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{backendCTS}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{CancellationTokenSource}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{GetFieldStreamsAsync}\PYG{p}{(}\PYG{n}{velocity}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{pressure}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{streamFunction}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{backendCTS}\PYG{p}{.}\PYG{n}{Token}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{catch}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{IOException}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{MessageBox}\PYG{p}{.}\PYG{n}{Show}\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{Message}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{catch}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{Exception}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{MessageBox}\PYG{p}{.}\PYG{n}{Show}\PYG{p}{(}\PYG{l+s}{\PYGZdl{}\PYGZdq{}Generic error: \PYGZob{}e.Message\PYGZcb{}\PYGZdq{}}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{CreateDefaultObstacle}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k+kt}{double}\PYG{+w}{ }\PYG{n}{scale}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{10}\PYG{p}{;}

\PYG{+w}{            }\PYG{c+c1}{// Define the bean.}
\PYG{+w}{            }\PYG{n}{controlPoints}\PYG{p}{.}\PYG{n}{Add}\PYG{p}{(}\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{p}{(}\PYG{n}{scale}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{PI}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{l+m}{4}\PYG{p}{));}
\PYG{+w}{            }\PYG{n}{controlPoints}\PYG{p}{.}\PYG{n}{Add}\PYG{p}{(}\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{p}{(}\PYG{n}{scale}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m}{3}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{PI}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{l+m}{4}\PYG{p}{));}
\PYG{+w}{            }\PYG{n}{controlPoints}\PYG{p}{.}\PYG{n}{Add}\PYG{p}{(}\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{p}{(}\PYG{n}{scale}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m}{5}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{PI}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{l+m}{4}\PYG{p}{));}
\PYG{+w}{            }\PYG{n}{controlPoints}\PYG{p}{.}\PYG{n}{Add}\PYG{p}{(}\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{p}{(}\PYG{n}{scale}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m}{7}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{PI}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{l+m}{4}\PYG{p}{));}
\PYG{+w}{            }\PYG{n}{controlPoints}\PYG{p}{.}\PYG{n}{Add}\PYG{p}{(}\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{p}{(}\PYG{n}{scale}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{Sqrt}\PYG{p}{(}\PYG{l+m}{2}\PYG{p}{),}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{PI}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{));}

\PYG{+w}{            }\PYG{k}{foreach}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{PolarPoint}\PYG{+w}{ }\PYG{n}{controlPoint}\PYG{+w}{ }\PYG{k}{in}\PYG{+w}{ }\PYG{n}{controlPoints}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{obstaclePointCalculator}\PYG{p}{.}\PYG{n}{AddControlPoint}\PYG{p}{(}\PYG{n}{controlPoint}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{n}{PlotObstaclePoints}\PYG{p}{();}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}summary\PYGZgt{}}
\PYG{+w}{        }\PYG{c+c1}{/// Wipes the \PYGZlt{}see cref=\PYGZdq{}ObstaclePoints\PYGZdq{}/\PYGZgt{} collection and plots new points based on the \PYGZlt{}see cref=\PYGZdq{}obstaclePointCalculator\PYGZdq{}/\PYGZgt{} function.}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}/summary\PYGZgt{}}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{PlotObstaclePoints}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{ObstaclePoints}\PYG{p}{.}\PYG{n}{Clear}\PYG{p}{();}
\PYG{+w}{            }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{double}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{0}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{numObstaclePoints}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{ObstaclePoints}\PYG{p}{.}\PYG{n}{Add}\PYG{p}{(}\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PolarPoint}\PYG{p}{(}\PYG{n}{obstaclePointCalculator}\PYG{p}{.}\PYG{n}{CalculatePoint}\PYG{p}{(}\PYG{n}{i}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{n}{numObstaclePoints}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{l+m}{2}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{PI}\PYG{p}{),}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{/}\PYG{+w}{ }\PYG{n}{numObstaclePoints}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{l+m}{2}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{n}{Math}\PYG{p}{.}\PYG{n}{PI}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{ObstaclePoints}\PYG{p}{));}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}summary\PYGZgt{}}
\PYG{+w}{        }\PYG{c+c1}{/// Gets the Smallest Enclosing Rectangle (SER) for the drawn obstacle.}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}/summary\PYGZgt{}}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}returns\PYGZgt{}The rectangle coordinates in the form: left x, bottom y, right x, right y.\PYGZlt{}/returns\PYGZgt{}}
\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{p}{)}\PYG{+w}{ }\PYG{n}{GetObstacleSER}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{return}\PYG{+w}{ }\PYG{p}{(}\PYG{l+m}{0}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m}{0}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m}{100}\PYG{p}{,}\PYG{+w}{ }\PYG{l+m}{100}\PYG{p}{);}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{EmbedObstacles}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k+kt}{bool}\PYG{p}{[]}\PYG{+w}{ }\PYG{n}{obstacles}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{p}{[(}\PYG{n}{dataWidth}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{dataHeight}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)];}
\PYG{+w}{            }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{1}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{\PYGZlt{}=}\PYG{+w}{ }\PYG{n}{dataWidth}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m}{1}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{\PYGZlt{}=}\PYG{+w}{ }\PYG{n}{dataHeight}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{obstacles}\PYG{p}{[}\PYG{n}{i}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{dataHeight}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{j}\PYG{p}{]}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{true}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// Set cells to fluid}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{left}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{bottom}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{right}\PYG{p}{,}\PYG{+w}{ }\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{top}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{GetObstacleSER}\PYG{p}{();}
\PYG{+w}{            }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{left}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{\PYGZlt{}=}\PYG{+w}{ }\PYG{n}{right}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{i}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{for}\PYG{+w}{ }\PYG{p}{(}\PYG{k+kt}{int}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{bottom}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{\PYGZlt{}=}\PYG{+w}{ }\PYG{n}{top}\PYG{p}{;}\PYG{+w}{ }\PYG{n}{j}\PYG{o}{++}\PYG{p}{)}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{PolarPoint}\PYG{+w}{ }\PYG{n}{polarPoint}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{PolarPoint}\PYG{p}{)}\PYG{n}{RecToPolConverter}\PYG{p}{.}\PYG{n}{Convert}\PYG{p}{(}\PYG{k}{new}\PYG{+w}{ }\PYG{n}{Point}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{j}\PYG{p}{),}\PYG{+w}{ }\PYG{k}{typeof}\PYG{p}{(}\PYG{n}{PolarPoint}\PYG{p}{),}\PYG{+w}{ }\PYG{n}{ObstacleCentre}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{System}\PYG{p}{.}\PYG{n}{Globalization}\PYG{p}{.}\PYG{n}{CultureInfo}\PYG{p}{.}\PYG{n}{CurrentCulture}\PYG{p}{);}
\PYG{+w}{                    }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{polarPoint}\PYG{p}{.}\PYG{n}{Radius}\PYG{+w}{ }\PYG{o}{\PYGZlt{}}\PYG{+w}{ }\PYG{n}{obstaclePointCalculator}\PYG{p}{.}\PYG{n}{CalculatePoint}\PYG{p}{(}\PYG{n}{polarPoint}\PYG{p}{.}\PYG{n}{Angle}\PYG{p}{))}\PYG{+w}{ }\PYG{c+c1}{// Within the obstacle}
\PYG{+w}{                    }\PYG{p}{\PYGZob{}}
\PYG{+w}{                        }\PYG{n}{obstacles}\PYG{p}{[}\PYG{n}{i}\PYG{+w}{ }\PYG{o}{*}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{dataHeight}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{j}\PYG{p}{]}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{false}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// Set cells to obstacle}
\PYG{+w}{                    }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{n}{\PYGZus{}}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{SendObstacles}\PYG{p}{(}\PYG{n}{obstacles}\PYG{p}{);}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{CloseBackend}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{o}{!}\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{CloseBackend}\PYG{p}{())}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{ForceCloseBackend}\PYG{p}{();}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{VisFPSUpdate}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{PropertyChangedEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{visFrameTimeAverage}\PYG{p}{.}\PYG{n}{UpdateAverage}\PYG{p}{(}\PYG{n}{visualisationControl}\PYG{p}{.}\PYG{n}{FrameTime}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{VisFPS}\PYG{p}{));}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{HandleBackendPropertyChanged}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{PropertyChangedEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{PropertyName}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{BackendStatus}\PYG{p}{))}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{BackendStatus}\PYG{p}{));}
\PYG{+w}{                }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{BackendButtonText}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}\PYG{+w}{ }
\PYG{+w}{            }\PYG{k}{else}\PYG{+w}{ }\PYG{n+nf}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{PropertyName}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{FrameTime}\PYG{p}{))}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{BackFPSUpdate}\PYG{p}{();}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{BackFPSUpdate}\PYG{p}{()}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{backFrameTimeAverage}\PYG{p}{.}\PYG{n}{UpdateAverage}\PYG{p}{(}\PYG{n}{backendManager}\PYG{p}{.}\PYG{n}{FrameTime}\PYG{p}{);}
\PYG{+w}{            }\PYG{n}{OnPropertyChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{BackFPS}\PYG{p}{));}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{    }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{Verbatim}
