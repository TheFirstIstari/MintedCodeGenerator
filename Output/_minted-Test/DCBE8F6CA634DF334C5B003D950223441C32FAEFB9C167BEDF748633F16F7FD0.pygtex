\begin{Verbatim}[commandchars=\\\{\}]
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.ComponentModel}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Threading.Tasks}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Windows}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{System.Windows.Input}\PYG{p}{;}
\PYG{k}{using}\PYG{+w}{ }\PYG{n+nn}{UserInterface.ViewModels}\PYG{p}{;}

\PYG{k}{namespace}\PYG{+w}{ }\PYG{n+nn}{UserInterface.HelperClasses}
\PYG{p}{\PYGZob{}}
\PYG{+w}{    }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{Commands}
\PYG{+w}{    }\PYG{p}{\PYGZob{}}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}summary\PYGZgt{}}
\PYG{+w}{        }\PYG{c+c1}{/// Base class for commands that are related to a specific ViewModel using dependency injection. Abstractly implements \PYGZlt{}see cref=\PYGZdq{}ICommand\PYGZdq{}/\PYGZgt{}.}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}/summary\PYGZgt{}}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}typeparam name=\PYGZdq{}VMType\PYGZdq{}\PYGZgt{}The type of the ViewModel that will be used with the Command.\PYGZlt{}/typeparam\PYGZgt{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{abstract}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{VMCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{VMType}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{ICommand}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{protected}\PYG{+w}{ }\PYG{n}{VMType}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{;}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{event}\PYG{+w}{ }\PYG{n}{EventHandler}\PYG{o}{?}\PYG{+w}{ }\PYG{n}{CanExecuteChanged}\PYG{p}{;}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{virtual}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{OnCanExecuteChanged}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{EventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{CanExecuteChanged}\PYG{o}{?.}\PYG{n}{Invoke}\PYG{p}{(}\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{virtual}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n+nf}{CanExecute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{return}\PYG{+w}{ }\PYG{k}{true}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{abstract}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{);}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{VMCommandBase}\PYG{p}{(}\PYG{n}{VMType}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{this}\PYG{p}{.}\PYG{n}{parentViewModel}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}summary\PYGZgt{}}
\PYG{+w}{        }\PYG{c+c1}{/// Base class for commands that deal with parameters, again using dependency injection to get the \PYGZlt{}see cref=\PYGZdq{}ParameterHolder\PYGZdq{} /\PYGZgt{}.}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}/summary\PYGZgt{}}
\PYG{+w}{        }\PYG{c+c1}{/// \PYGZlt{}typeparam name=\PYGZdq{}VMType\PYGZdq{}\PYGZgt{}The type fo the ViewModel that will be used with the Command.\PYGZlt{}/typeparam\PYGZgt{}}
\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{abstract}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{ParameterCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{VMType}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{VMCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{VMType}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{protected}\PYG{+w}{ }\PYG{n}{ParameterHolder}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{;}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{ParameterCommandBase}\PYG{p}{(}\PYG{n}{VMType}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ParameterHolder}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{this}\PYG{p}{.}\PYG{n}{parameterHolder}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{SetAirParameters}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{VMCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{ConfigScreenVM}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{ReynoldsNo}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{REYNOLDS\PYGZus{}NUMBER}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Viscosity}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{DefaultParameters}\PYG{p}{.}\PYG{n}{FLUID\PYGZus{}VISCOSITY}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{SetAirParameters}\PYG{p}{(}\PYG{n}{ConfigScreenVM}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{AdvancedParametersReset}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{ParameterCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{AdvancedParametersVM}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{TimeStepSafetyFactor}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Tau}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{TimeStepSafetyFactor}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}

\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{RelaxationParameter}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Omega}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{RelaxationParameter}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}

\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureResidualTolerance}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{RMax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureResidualTolerance}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}

\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureMaxIterations}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{IterMax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureMaxIterations}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{AdvancedParametersReset}\PYG{p}{(}\PYG{n}{AdvancedParametersVM}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ParameterHolder}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{ConfigScreenReset}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{ParameterCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{ConfigScreenVM}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{InflowVelocity}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{InVel}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{InflowVelocity}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}

\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{SurfaceFriction}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Chi}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{SurfaceFriction}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}

\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{Width}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Width}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{Width}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}

\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{Height}\PYG{p}{.}\PYG{n}{Reset}\PYG{p}{();}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Height}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{Height}\PYG{p}{.}\PYG{n}{DefaultValue}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{ConfigScreenReset}\PYG{p}{(}\PYG{n}{ConfigScreenVM}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ParameterHolder}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{SaveParameters}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{ParameterCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{AdvancedParametersVM}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{private}\PYG{+w}{ }\PYG{n}{ParameterStruct}\PYG{o}{\PYGZlt{}}\PYG{n}{T}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{o}{\PYGZlt{}}\PYG{n}{T}\PYG{o}{\PYGZgt{}}\PYG{p}{(}\PYG{n}{ParameterStruct}\PYG{o}{\PYGZlt{}}\PYG{n}{T}\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{n}{parameterStruct}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{T}\PYG{+w}{ }\PYG{n}{newValue}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterStruct}\PYG{p}{.}\PYG{n}{Value}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{newValue}\PYG{p}{;}
\PYG{+w}{                }\PYG{k}{return}\PYG{+w}{ }\PYG{n}{parameterStruct}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{TimeStepSafetyFactor}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{TimeStepSafetyFactor}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Tau}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{RelaxationParameter}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{RelaxationParameter}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{Omega}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureResidualTolerance}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureResidualTolerance}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{RMax}\PYG{p}{);}
\PYG{+w}{                }\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureMaxIterations}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ModifyParameterValue}\PYG{p}{(}\PYG{n}{parameterHolder}\PYG{p}{.}\PYG{n}{PressureMaxIterations}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{IterMax}\PYG{p}{);}

\PYG{+w}{                }\PYG{n}{App}\PYG{p}{.}\PYG{n}{RaisePopupDeleted}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{EventArgs}\PYG{p}{());}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{SaveParameters}\PYG{p}{(}\PYG{n}{AdvancedParametersVM}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ParameterHolder}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ChangeWindow}\PYG{+w}{ }\PYG{n}{changeWindowCommand}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{parameterHolder}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{SwitchPanel}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{VMCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{SimulationScreenVM}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k+kt}{string}\PYG{+w}{ }\PYG{n}{name}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{((}\PYG{n}{FrameworkElement}\PYG{p}{)}\PYG{n}{parameter}\PYG{p}{).}\PYG{n}{Name}\PYG{p}{;}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{name}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{CurrentButton}\PYG{p}{)}\PYG{+w}{ }\PYG{c+c1}{// If the button of the currently open panel is clicked, set the current button to null to close all panels (toggle functionality).}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{CurrentButton}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{;}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                }\PYG{k}{else}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{CurrentButton}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{name}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// If any other panel is open, or no panel is open, open the one corresponding to the button.}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{SwitchPanel}\PYG{p}{(}\PYG{n}{SimulationScreenVM}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{ChangeWindow}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{ICommand}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{event}\PYG{+w}{ }\PYG{n}{EventHandler}\PYG{o}{?}\PYG{+w}{ }\PYG{n}{CanExecuteChanged}\PYG{p}{;}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n+nf}{CanExecute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{return}\PYG{+w}{ }\PYG{k}{true}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}\PYG{+w}{ }\PYG{c+c1}{// Unless app logic changes, this command can always execute.}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{parameter}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{return}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                }\PYG{n}{App}\PYG{p}{.}\PYG{n}{RaiseUserControlChanged}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{UserControlChangeEventArgs}\PYG{p}{((}\PYG{n}{Type}\PYG{p}{)}\PYG{n}{parameter}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{CreatePopup}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{ICommand}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{event}\PYG{+w}{ }\PYG{n}{EventHandler}\PYG{o}{?}\PYG{+w}{ }\PYG{n}{CanExecuteChanged}\PYG{p}{;}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n+nf}{CanExecute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{\PYGZob{}}\PYG{+w}{ }\PYG{k}{return}\PYG{+w}{ }\PYG{k}{true}\PYG{p}{;}\PYG{+w}{ }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{parameter}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{k}{null}\PYG{p}{)}\PYG{+w}{ }\PYG{k}{return}\PYG{p}{;}
\PYG{+w}{                }\PYG{n}{App}\PYG{p}{.}\PYG{n}{RaisePopupCreated}\PYG{p}{(}\PYG{k}{this}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{UserControlChangeEventArgs}\PYG{p}{((}\PYG{n}{Type}\PYG{p}{)}\PYG{n}{parameter}\PYG{p}{));}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{PauseResumeBackend}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{VMCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{SimulationScreenVM}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k+kt}{bool}\PYG{+w}{ }\PYG{n+nf}{CanExecute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{return}\PYG{+w}{ }\PYG{o}{!}\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{EditingObstacles}\PYG{p}{;}\PYG{+w}{ }\PYG{c+c1}{// Cannot execute when editing obstacles.}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{switch}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{BackendStatus}\PYG{p}{)}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{k}{case}\PYG{+w}{ }\PYG{n}{BackendStatus}\PYG{p}{.}\PYG{n}{Running}\PYG{p}{:}
\PYG{+w}{                        }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{BackendCTS}\PYG{p}{.}\PYG{n}{Cancel}\PYG{p}{();}\PYG{+w}{ }\PYG{c+c1}{// Pause the backend.}
\PYG{+w}{                        }\PYG{k}{break}\PYG{p}{;}
\PYG{+w}{                    }\PYG{k}{case}\PYG{+w}{ }\PYG{n}{BackendStatus}\PYG{p}{.}\PYG{n}{Stopped}\PYG{p}{:}
\PYG{+w}{                        }\PYG{n}{Task}\PYG{p}{.}\PYG{n}{Run}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{StartComputation}\PYG{p}{);}\PYG{+w}{ }\PYG{c+c1}{// Resume the backend computation.}
\PYG{+w}{                        }\PYG{k}{break}\PYG{p}{;}
\PYG{+w}{                    }\PYG{k}{default}\PYG{p}{:}
\PYG{+w}{                        }\PYG{k}{break}\PYG{p}{;}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{PauseResumeBackend}\PYG{p}{(}\PYG{n}{SimulationScreenVM}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{PropertyChanged}\PYG{+w}{ }\PYG{o}{+=}\PYG{+w}{ }\PYG{n}{VMPropertyChanged}\PYG{p}{;}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}

\PYG{+w}{            }\PYG{k}{private}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{VMPropertyChanged}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{PropertyChangedEventArgs}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{e}\PYG{p}{.}\PYG{n}{PropertyName}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{n}{nameof}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{EditingObstacles}\PYG{p}{))}\PYG{+w}{ }\PYG{n}{OnCanExecuteChanged}\PYG{p}{(}\PYG{n}{sender}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{e}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}

\PYG{+w}{        }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{class}\PYG{+w}{ }\PYG{n+nc}{EditObstacles}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{n}{VMCommandBase}\PYG{o}{\PYGZlt{}}\PYG{n}{SimulationScreenVM}\PYG{o}{\PYGZgt{}}
\PYG{+w}{        }\PYG{p}{\PYGZob{}}
\PYG{+w}{            }\PYG{n}{PauseResumeBackend}\PYG{+w}{ }\PYG{n}{BackendCommand}\PYG{p}{;}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{k}{override}\PYG{+w}{ }\PYG{k}{void}\PYG{+w}{ }\PYG{n+nf}{Execute}\PYG{p}{(}\PYG{k+kt}{object?}\PYG{+w}{ }\PYG{n}{parameter}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{k}{if}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{EditingObstacles}\PYG{p}{)}\PYG{+w}{ }\PYG{c+c1}{// Obstacle editing is finished, need to embed obstacles and start backend executing.}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{EditingObstacles}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{false}\PYG{p}{;}
\PYG{+w}{                    }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{EmbedObstacles}\PYG{p}{();}
\PYG{+w}{                    }\PYG{n}{BackendCommand}\PYG{p}{.}\PYG{n}{Execute}\PYG{p}{(}\PYG{k}{null}\PYG{p}{);}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{                }\PYG{k}{else}\PYG{+w}{ }\PYG{c+c1}{// Obstacle editing has started, need to stop backend and allow obstacles to be edited.}
\PYG{+w}{                }\PYG{p}{\PYGZob{}}
\PYG{+w}{                    }\PYG{n}{BackendCommand}\PYG{p}{.}\PYG{n}{Execute}\PYG{p}{(}\PYG{k}{null}\PYG{p}{);}
\PYG{+w}{                    }\PYG{n}{parentViewModel}\PYG{p}{.}\PYG{n}{EditingObstacles}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{true}\PYG{p}{;}
\PYG{+w}{                }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{            }\PYG{k}{public}\PYG{+w}{ }\PYG{n+nf}{EditObstacles}\PYG{p}{(}\PYG{n}{SimulationScreenVM}\PYG{+w}{ }\PYG{n}{parentViewModel}\PYG{p}{)}\PYG{+w}{ }\PYG{p}{:}\PYG{+w}{ }\PYG{k}{base}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{)}
\PYG{+w}{            }\PYG{p}{\PYGZob{}}
\PYG{+w}{                }\PYG{n}{BackendCommand}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{k}{new}\PYG{+w}{ }\PYG{n}{PauseResumeBackend}\PYG{p}{(}\PYG{n}{parentViewModel}\PYG{p}{);}
\PYG{+w}{            }\PYG{p}{\PYGZcb{}}
\PYG{+w}{        }\PYG{p}{\PYGZcb{}}
\PYG{+w}{    }\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{Verbatim}
